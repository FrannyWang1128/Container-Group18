# Ice Cream Management System

## Introduction
This is the project repository for the group assignment in the course Software Containerization at the Vrije Universiteit, Amsterdam for the academic year 2023-2024 by group 18. The goal of the assignment is to implement the Ice Cream Management System, a simple application to manage ice cream products, powered by a Node.js backend and MongoDB. This README provides instructions on how to set up, run, update, and delete the application.

## Prerequisites
Before you begin, ensure that you have Docker installed on your system. 

1. [Docker](https://www.docker.com/products/docker-desktop/) is used to create, deploy, and run applications by using containers. Docker Compose is required to manage the application with its services.

2. [Minikube](https://minikube.sigs.k8s.io/docs/start/) installed: Minikube is a tool that allows you to run a single-node Kubernetes cluster locally on your machine.

3. [Helm](https://helm.sh/docs/intro/install/) installed: Helm is a package manager for Kubernetes that simplifies deploying and managing applications.

4. [Google Cloud SDK Shell](https://cloud.google.com/sdk/) installed: Cloud SDK is a set of tools, including gcloud, gsutil, and bq command-line tools, client libraries & local emulators for developing with Google Cloud.

### Load Balancer
One sevice of type load balancer is configured.

nodeapp-deployment.yaml configured a load balancer named outlets-service which will select pods with frontend label to associate with. It listens on port 80 of the cluster IP and redirects the traffic to the port 3000 of the associated pods.

External IP and node port are automatically generated by the LB. Check the status of the load balancer using the following command.

```
kubectl get svc
NAME                    TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)          AGE
kubernetes              ClusterIP      10.48.0.1      <none>           443/TCP          4d2h
mongo-express-service   NodePort       10.48.13.37    <none>           8081:30010/TCP   3d22h
mongodb-service         ClusterIP      10.48.4.179    <none>           27017/TCP        3d22h
nodeapp-service         LoadBalancer   10.48.6.219    35.234.168.146   80:30011/TCP     3d22h
```

### Storage Class
For storage, we used MongoDB. Instead of a StatefulSet, we configured a deployment mongodb-deployment.yaml to set up the mongoDB. Alongside the database deployment, a mongo-serivce is also configured which listens on port 27107 of the cluster IP and redirects the traffic to the port 27017 of the MongoDB pod. In order to avoid external excess, the mongodb-service only exposes on cluster IP. Node port and external IP are not established. 
In terms of storage volume, a static persistent volume of 1 GB which allows read and write from a single node and resides on the host path is created in mongodb-pv.yaml. Respectively, a persistent volume claim is also created in mongodb-pvc.yaml. The reclaim policy of the PVC is Retain since the bonded volume is not dynamically allocated.

In addition, a Secret mongo-secret.yaml and a ConfigMap mongo-configmap.yaml are also configured to store the configurations and credentials for the MongoDB. Those information are referred inside the specification of the MongoDB pod and API pod.

### Image Registry

The images involved in our project reside on the docker hub. The information about the image registry is stored in the values of the helm chart. When deploying the helm chart, deployment which invoke images will use the settings specified in the values of the helm chart.

### Certificates

To enable TLS security for our application, we first created a self-signed cluster issuer using the cert-manager API of kubernetes in app-ca-issuer.yaml. Then, we use it to create a root certificate which will be stored in a secret file named ca-key-pair. After that, we are able to facilitate a privat CA app-tls-certificate.yaml using the root certificate to sign certificate for our application ingress. Finally, our ingress controller defined in ingress.yaml can refer to the private CA and get a certificate to enable TLS security. The certificate is stored in a secret file named my-app-tls.

Check whether myicecreamapp is accessible via https:
`https://www.myicecreamapp.com`

Check whether http redirect works properly:
`http://www.myicecreamapp.com`

### Roles

### Network Policies


## Quick Start with Helm on Google Cloud Platform

### Clone the Repository
1. If applicable, clone the repository to your local machine (or download the Helm charts and any other necessary files from the given source).

### Connect to the cluster on Google Cloud Platform
2. `gcloud container clusters get-credentials software-containerization-g18-cluster --zone europe-west4-a --project quixotic-market-412417`

### Install the Application Using Helm
3. Run the following command to install the application using Helm in the default namespace (you can replace default namespace with the desired namespace):

   `helm install my-ice-cream-app [CHART_PATH]`
### Access the application
4. Once the deployment is successful, you can access the application and the Mongo Express web interface using the following commands:

   To access the Node.js application:
   `minikube service nodeapp-service -n test-namespace`
   
   To access the Mongo Express web interface:
   `minikube service mongo-express-service -n test-namespace`

   These commands will open your default web browser and take you to the respective services.

### Access the application
5. If you want to remove the application from your cluster, you can run:
   `helm uninstall my-ice-cream-app -n test-namespace`
   This will uninstall the application and release the associated resources.

# Services
The system includes the following services:

mongodb: A MongoDB database server accessible on port `27017`.

nodeapp: The Ice Cream Management Node.js application accessible on port `3000`.

mongo-express: A Mongo Express web interface accessible on port `8081`, which provides a web-based MongoDB admin interface.

## Container build and first deployment, scaling, uninstallation

### Image build and Push

1. **Clone the repository:**

      If applicable, clone the repository to your local machine.

2. **Navigate to the project directory:**

      Change into the project directory where the `compose.yml` file is located.

3. **Build icecream app image**
   
      ` docker build -t zhuoran0219/ice-cream-management:1.0`

4. **Push icecream app image**
   
      ` docker push zhuoran0219/ice-cream-management:1.0`

### Deploy application


1. **Connect to the cluster on Google Cloud Platform**
   
      Use Google Cloud SDK Shell to connect to the cluster we established

      `gcloud container clusters get-credentials software-containerization-g18-cluster --zone europe-west4-a --project quixotic-market-412417`

3. **Install the Application Using Helm**
   
      Run the following command to install the application using Helm in the default namespace (you can replace default namespace with the desired namespace):

      ` helm install my-ice-cream-app [CHART_PATH] `

4. **Check helm deployment status**

      `helm list`


